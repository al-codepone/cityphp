<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Database System</title>
        <meta name="description" content=""/>
        <meta charset="utf-8"/>
        <link type="text/css" rel="stylesheet" href="styles.css"/>
    </head>
    <body>
        <a href="index.html">< Home</a>
        <h2>Database System</h2>
        <p>There is a database handle class for each RDBMS vendor. Let's see how to use database handle by looking at MySqlDatabaseHandle. First make a database connection using the constructor:</p>
        <pre>&lt;?php

require_once('./constants.php');
require_once(CITY_PHP . 'database/MySqlDatabaseHandle.php');

$databaseHandle = new MySqlDatabaseHandle('host',
    'username', 'password', 'database');

?&gt;</pre>
        <p>You'll mainly use three database handle methods: query(), fetchQuery() and escapeString(). Let's use query() to create a table:</p>
        <pre>&lt;?php

$databaseHandle-&gt;query('CREATE TABLE words (
    word_id TINYINT AUTO_INCREMENT NOT NULL PRIMARY KEY,
    word VARCHAR(64))
    ENGINE = InnoDB');

?&gt;</pre>
        <p>Now let's use query() and escapeString() to insert some rows:</p>
        <pre>&lt;?php

$words = array('one', "'two'", '"three"',
    '&&gt;&lt;\/"', 'five', 'six');

$query = 'INSERT INTO words (word_id, word) VALUES';

foreach($words as $i =&gt; $word) {
    $query .= $i &gt; 0 ? ',' : '';
    $query .= sprintf('(NULL, "%s")',
        $databaseHandle-&gt;escapeString($word));
}

$databaseHandle-&gt;query($query);

?&gt;</pre>
        <p>We can use fetchQuery() to get our row data as an array of arrays:</p>
        <pre>&lt;?php

$query = 'SELECT word_id, word FROM words';

foreach($databaseHandle-&gt;fetchQuery($query) as $row) {
    printf('%s=%s ', $row['word_id'], htmlspecialchars($row['word']));
}

?&gt;</pre>
        <p>A database handle object will handle database errors for you. When a database error occurs the error message is displayed. Set the error message using the constructor:</p>
        <pre>&lt;?php

require_once('./constants.php');
require_once(CITY_PHP . 'database/MySqlDatabaseHandle.php');

//use an HTML document for the error message
$errorMessage = '&lt;!DOCTYPE html&gt;&lt;html&gt;
    &lt;head&gt;&lt;title&gt;Database Error&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;There was a database error. Try again.&lt;/body&gt;
    &lt;/html&gt;';

//add the null port, null socket and the error message
$databaseHandle = new MySqlDatabaseHandle('host',
    'username', 'password', 'database',
    null, null, $errorMessage);

?&gt;</pre>
        <p>You should put your database logic in class methods. Here's one way to do it by extending MySqlDatabaseHandle:</p>
        <pre>&lt;?php

require_once(CITY_PHP . 'database/MySqlDatabaseHandle.php');

class DatabaseApi extends MySqlDatabaseHandle {
    public function __construct() {
        $errorMessage = '&lt;!DOCTYPE html&gt;&lt;html&gt;
            &lt;head&gt;&lt;title&gt;Database Error&lt;/title&gt;&lt;/head&gt;
            &lt;body&gt;There was a database error. Try again.&lt;/body&gt;
            &lt;/html&gt;';

        parent::__construct('host', 'username',
            'password', 'database',
            null, null, $errorMessage);
    }

    public function install() {
        $this-&gt;query('CREATE TABLE words (
            word_id TINYINT AUTO_INCREMENT NOT NULL PRIMARY KEY,
            word VARCHAR(64))
            ENGINE = InnoDB');
    }

    public function selectWords() {
        return $this-&gt;fetchQuery('SELECT word_id, word FROM words');
    }

    public function insertWords(array $words) {
        $query = 'INSERT INTO words (word_id, word) VALUES';

        foreach($words as $i =&gt; $word) {
            $query .= $i &gt; 0 ? ',' : '';
            $query .= sprintf('(NULL, "%s")',
                $this-&gt;escapeString($word));
        }

        $this-&gt;query($query);
    }
}

?&gt;</pre>
        <p>Then we can use it like this:</p>
        <pre>&lt;?php

require_once('./constants.php');
require_once('./classes/DatabaseApi.php');

$words = array('one', "'two'", '"three"',
    '&&gt;&lt;\/"', 'five', 'six');

$databaseApi = new DatabaseApi();

$databaseApi-&gt;install();
$databaseApi-&gt;insertWords($words);

foreach($databaseApi-&gt;selectWords() as $row) {
    printf('%s=%s ', $row['word_id'], htmlspecialchars($row['word']));
}

?&gt;</pre>
        <p><a href="form_handler.html">Go to the next page: Form Handler</a></p>
    </body>
</html>
